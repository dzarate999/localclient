<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
        integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
        crossorigin=""></script>
        <!--https://coolors.co/dcdcdc-262626-f5f5f5-a9b2ac-898980--> 
    <style>

        body {
            margin: 0;
            background: #f5f5f5;
            color: #262626;
        }

        a {
            color: #262626;
        }

        a:hover {
            color: #9c9c9c;
        }

        #nav {
            text-indent: 50px;
            background: #dcdcdc;
        }

        section {
            height: 50px;
            padding: 0;
            display: table-cell;
            vertical-align: middle;
        }

        #myLoc {
            border-radius: 10px 10px 0px 0px;
            height: 200px;
            width: 250px;
        }

        #loc {
            width: 250px;
            border-radius: 10px;
            box-shadow: 5px 5px 10px black;
            background: #3f3f3f;
            color: #f5f5f5;
        }

        section#location {
            text-align: center;
            padding-left: 25px;
        }

        #container {
            border: 0px;
            text-align: center;
            padding: 10px;
        }

        #submit {
            background: #dcdcdc;
            border: 0px;
            padding: 5px;
            border-radius: 5px;
            color: #262626;
        }

        #submit:active {
            color: #262626;
            background: #bebebe;
        }

        #mood {
            width: 250px;
            text-align: center;
            padding: 20px 0px 0px 0px;
            border: 0px;
        }

        h1 {
            color: #262626;
        }

        h2 {
            color: #262626;
        }
    </style>
    <title>Node.js</title>
</head>

<body>
    <div id="nav">
        <section>
            <a href="data.html">Data Storage On This Server</a>
        </section>
    </div>
    <h1>Data Selfie App</h1>

    <section id="location">
        <h2>Current Location</h2>

        <div id="loc">
            <div id="myLoc"></div>
                <div id="container">
                <p>Latitude: <span id="lat"></span>&deg;<br></p>
                <p>Longitude: <span id="lon"></span>&deg;<br></p>
                <center><button id="submit">Submit</button></center>
            </div>
        </div>
        <div id="mood">
            Mood: <input type="text" id="feels">
        </div>
    </section>

    <script>
        let lat, lon;

        const button = document.getElementById('submit');
        button.addEventListener('click', async event => {
            const feels = document.getElementById('feels').value;
            const data = { lat, lon, feels };
            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            };
            const response = await fetch('/api', options);
            const json = await response.json();
            console.log(json);
        });


        if ("geolocation" in navigator) {
            /* geolocation is available */
            console.log('geolocation available');
            navigator.geolocation.getCurrentPosition(async position => {
                lat = position.coords.latitude;
                lon = position.coords.longitude;
                document.getElementById('lat').textContent = lat.toFixed(2);
                document.getElementById('lon').textContent = lon.toFixed(2);
                const mymap = L.map('myLoc').setView([lat, lon], 15);
                const attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
                const tileURL = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
                const tiles = L.tileLayer(tileURL, { attribution });
                tiles.addTo(mymap);
                const marker = L.marker([lat, lon]).addTo(mymap);
            });

            } else {
                /* geolocation IS NOT available */
                console.log('geolocation unavailable');
            }
    </script>
</body>

</html>